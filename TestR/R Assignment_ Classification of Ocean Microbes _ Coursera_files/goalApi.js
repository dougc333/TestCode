define("bundles/ondemand/utils/goalApi",["require","exports","module","q","bundles/ondemand/actions/ServerActionCreators","bundles/ondemand/actions/ServerActionCreators","bundles/ondemand/constants/Constants","bundles/phoenix/lib/apiWrapper","bundles/phoenix/template/models/userIdentity","i18n!nls/ondemand","pages/open-course/common/singletons/course"],function(require,exports,module){"use strict";var r=require("q"),e=require("bundles/ondemand/actions/ServerActionCreators"),t=require("bundles/ondemand/actions/ServerActionCreators"),s=require("bundles/ondemand/constants/Constants"),a=require("bundles/phoenix/lib/apiWrapper"),i=require("bundles/phoenix/template/models/userIdentity"),u=require("i18n!nls/ondemand"),d=require("pages/open-course/common/singletons/course"),o=a(s.goalApi,{type:"rest"}),n={constructBasePath:function constructBasePath(e,n){return e.toString()+"~"+n.toString()},getCourseIdAndUserId:function getCourseIdAndUserId(){return d.then(function(e){return[e.get("id"),i.get("id")]})},getGoal:function getGoal(){var r=this;return n.getCourseIdAndUserId().spread(function(e,n){return o.get(r.constructBasePath(n,e))}).then(function(o){var e=o.elements[0],r=e.goalType,s=e.description,n={goalType:r,description:s};return t.initGoalData(n),n}).fail(function(n){switch(n.status){case 404:t.initGoalData({goalType:"NOT_SET",description:""});break;default:e.displayError(n)}}).done()},sendGoal:function sendGoal(s,a){var t=void 0;return n.getCourseIdAndUserId().spread(function(e,n){return t={data:{userId:n,courseId:e,goalType:s,description:a}},r(o.post("",t))}).then(function(t){var n=t.elements[0],o=n.goalType,r=n.description;e.updateNewGoal({goalType:o,description:r})}).fail(function(n){e.displayError(n)}).done()}};module.exports=n});