define("bundles/discussions/viewModels/viewContext",["require","exports","module","js/lib/path","backbone-associations","pages/open-course/common/constants","bundles/discussions/utils/discussionsUrl","i18n!nls/discussions"],function(require,exports,module){"use strict";var i=require("js/lib/path"),Backbone=require("backbone-associations"),t=require("pages/open-course/common/constants"),e=require("bundles/discussions/utils/discussionsUrl"),o=e.getWeekDiscussionsUrl,n=e.getGroupForumLink,u=e.getEmbeddedItemDiscussionsUrl,s=require("i18n!nls/discussions"),h=Backbone.AssociatedModel.extend({initialize:function initialize(t){if(this.setupDefaultAttrs(),t.itemMetadata)this.setupItemContext(t);else if(t.question)this.setupQuestionContext(t);else if(t.course&&t.week)this.setupWeekContext(t);else if(t.course&&t.module)this.setupModuleContext(t);else if(t.course&&t.forum)this.setupForumContext(t);else if(t.course&&t.group)this.setupGroupContext(t);else{if(!t.course)throw Error("Unknown context type used. Should pass course, itemMetadata, module, forum, week, or question");this.setupCourseContext(t)}this.get("link")||this.set("link",this.get("model").getLink()),this.get("id")||this.set("id",this.get("model").get("id")),this.get("discussionsLink")||this.setupLink()},setupLink:function setupLink(){var e=this.get("link"),s=e.replace(t.courseRootPath,"");this.set("discussionsLink",i.join(t.courseRootPath,"discussions",s))},getDisplayName:function getDisplayName(){return this.get("name")},setupCourseContext:function setupCourseContext(e){this.set("type",this.types().Course),this.set("model",e.course),this.set("courseId",this.get("model").get("id")),this.set("contentType","course"),this.set("name",s("All Threads")),this.set("discussionsLink",i.join(t.courseRootPath,"discussions","all"))},setupItemContext:function setupItemContext(t){this.set("type",this.types().Item),this.set("model",t.itemMetadata),this.set("courseId",this.get("model").get("course").get("id")),this.set("contentType",this.get("model").get("content").typeName),this.set("name",this.get("model").get("name")),this.set("discussionsLink",u(this.get("model")))},setupQuestionContext:function setupQuestionContext(t){this.set("type",this.types().Question),this.set("model",t.question),this.set("courseId",this.get("model").get("viewContext").get("courseId")),this.set("contentType",this.get("model").get("viewContext").get("contentType")),this.set("link",this.get("model").get("viewContext").get("link")),this.set("discussionsLink",this.get("model").get("viewContext").get("discussionsLink")),this.set("name",this.get("model").get("name")),"group"===this.get("contentType")&&this.set("groupId",this.get("model").get("viewContext").get("group").get("id"))},setupModuleContext:function setupModuleContext(t){this.set("type",this.types().Module),this.set("model",t.module),this.set("courseId",t.course.get("id")),this.set("contentType","module"),this.set("name",this.get("model").get("name"))},setupWeekContext:function setupWeekContext(t){this.set("type",this.types().Week),this.set("courseId",t.course.get("id")),this.set("contentType","week"),this.set("name",s("Week "+t.week)),this.set("id",t.week),this.set("link",o(t.week)),this.set("discussionsLink",o(t.week))},setupForumContext:function setupForumContext(t){this.set("type",this.types().Forum),this.set("model",t.forum),this.set("courseId",t.course.get("id")),this.set("contentType","forum"),this.set("name",this.get("model").get("name"))},setupGroupContext:function setupGroupContext(t){"facilitatedGroup"===t.group.get("typeName")&&t.group.set("name",s("Your Cohort Discussions")),this.set("type",this.types().Group),this.set("model",t.group),this.set("courseId",t.course.get("id")),this.set("groupId",this.get("model").get("id")),this.set("contentType","group"),this.set("name",this.get("model").get("name")),this.set("discussionsLink",n(this.get("groupId")))},setupDefaultAttrs:function setupDefaultAttrs(){this.set("contentType",""),this.set("name",""),this.set("id","")},isType:function isType(t){return this.get("type")===t},types:function types(){return{Course:"course",Item:"item",Question:"question",Module:"module",Forum:"forum",Group:"group",Week:"week"}}});module.exports=h});