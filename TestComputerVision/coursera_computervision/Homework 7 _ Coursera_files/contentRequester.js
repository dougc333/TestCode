define("pages/open-course/common/contentRequester",["require","exports","module","q","bundles/phoenix/template/models/userIdentity","js/lib/path","jsuri","pages/open-course/common/api","memoize!pages/open-course/common/promises/courseGrade","memoize!pages/open-course/common/promises/courseProgress"],function(require,exports,module){"use strict";var o=require("q"),r=require("bundles/phoenix/template/models/userIdentity"),e=require("js/lib/path"),s=require("jsuri"),a=require("pages/open-course/common/api"),n=require("memoize!pages/open-course/common/promises/courseGrade"),i=require("memoize!pages/open-course/common/promises/courseProgress"),m=function apiUrl(e){var t={closedPeer:"peer",gradedPeer:"peer",phasedPeer:"peer"};return t[e]||e},u=function buildBaseUrl(){return e.join("user",r.get("id"),"course",this.itemMetadata.get("course").get("slug"),"item",this.itemMetadata.getId(),m(this.itemMetadata.getTypeName()))},t=function ContentRequester(e){this.itemMetadata=e};t.prototype.request=function(r,p){var t=this.itemMetadata,c=u.call(this),m=new s(e.join(c,r));/action/.test(r)&&m.addQueryParam("autoEnroll","false");var d={data:{contentRequestBody:p}};return o.all([n(t.get("course").get("id")),i(t.get("course").get("slug")),a.post(m.toString(),d)]).spread(function(o,n,e){var r=t.getId(),s=n.getItemProgress(r);s&&e&&e.itemProgress&&s.set(e.itemProgress,{refreshCourseProgress:!0});var a=o.getItemGrade(r);return a&&e&&e.itemGradeRecord&&(a.set(e.itemGradeRecord),o.refresh()),e.contentResponseBody})},module.exports=t});