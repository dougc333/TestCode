define("bundles/assess/assessmentTypes/phoenixQuiz/assessment.header",["require","exports","module","moment","underscore","bundles/assess/assessmentTypes/phoenixQuiz/assessment.examHeader.html","bundles/assess/assessmentTypes/phoenixQuiz/assessment.quizHeader.html","bundles/payments-common/components/ReactPriceDisplay","bundles/payments/promises/productPrices","bundles/phoenix/lib/view","bundles/ondemand/components/endOfCourse/components/CourseCompleteModal","bundles/assess/components/HeaderNumberOfAttempts","js/lib/imgix","js/lib/pluralize","js/lib/pluralizer","pages/open-course/common/constants","pages/open-course/common/views/performanceBar"],function(require,exports,module){"use strict";var e=require("moment"),_=require("underscore"),o=require("bundles/assess/assessmentTypes/phoenixQuiz/assessment.examHeader.html"),s=require("bundles/assess/assessmentTypes/phoenixQuiz/assessment.quizHeader.html"),a=require("bundles/payments-common/components/ReactPriceDisplay"),n=require("bundles/payments/promises/productPrices"),i=require("bundles/phoenix/lib/view"),r=require("bundles/ondemand/components/endOfCourse/components/CourseCompleteModal"),u=require("bundles/assess/components/HeaderNumberOfAttempts"),l=require("js/lib/imgix"),m=require("js/lib/pluralize"),d=require("js/lib/pluralizer"),t=require("pages/open-course/common/constants"),p=require("pages/open-course/common/views/performanceBar"),c=i.extend({stateModelProperty:"model",initialize:function initialize(s){_(this).extend(_(s).pick("metadata","nextItemMetadataOrItemGroup","courseMaterials","verificationDisplay")),this.learnerStoryImg=l.processImage(t.vcLandingLearnerPhoto,{height:68}),this.landingPagePath=t.vcLandingPagePath,this.initializeEvents(),this.initializeSubViews(),this.initializePluralizer(),this.moment=e},initializeSubViews:function initializeSubViews(){"exam"!==this.metadata.getTypeName()&&(this.performanceBar=new p({evaluation:this.model.get("evaluation"),showValue:!1}))},initializePluralizer:function initializePluralizer(){this.pluralize=m,this.pluralizer=new d(this.$el),this.pluralizer.setRules({"num-questions":{model:this.model,property:"questionInstances",converter:_.property("length")}})},initializeEvents:function initializeEvents(){this.listenTo(this.model,"question:added",this.renderMetadata),this.listenTo(this.model,"change:state",this.renderState),this.listenTo(this.model,"state:enter:submitted",this.renderEvaluation)},template:function template(e){return"exam"===this.metadata.getTypeName()?o(e):s(e)},renderSubviews:function renderSubviews(){if(this.performanceBar&&this.$$("performance-bar-container").html(this.performanceBar.render().el),"exam"===this.metadata.getTypeName()){var t=this.metadata.getDefinition("lockingConfiguration"),s=e(),a=e(s).add(t.allowedSubmissionsInterval,"milliseconds"),n=a.from(s,!0);this.renderReactInto(u,"HeaderNumberOfAttempts",{numberOfAttempts:t.allowedSubmissionsPerInterval,interval:n})}},renderCourseCompleteModal:function renderCourseCompleteModal(){this.renderReactInto(r,"CourseCompleteModal",{})},renderEvaluation:function renderEvaluation(){"exam"===this.metadata.getTypeName()?this.renderExamEvaluation():this.renderQuizEvaluation()},renderMetadata:function renderMetadata(){this.$$("num-questions-label").html(this.model.get("questionInstances").length)},renderQuizEvaluation:function renderQuizEvaluation(){var e=this.model.get("evaluation");if(!e)return;var t=e.isPassed(),s=this.$$(t?"next-button":"retake-button"),a=this.$$(t?"retake-button":"next-button"),n=this.$$(t?"passed-label":"not-passed-label"),i=this.$$(t?"not-passed-label":"passed-label");t?this.$$("performance-bar-container").removeClass("c-performance-bar-dim"):this.$$("performance-bar-container").addClass("c-performance-bar-dim"),s.removeClass("c-btn-white").addClass("bt3-btn-success"),a.removeClass("bt3-btn-success").addClass("c-btn-white"),n.show(),i.hide(),this.$$("num-points-earned-label").html(e.getDisplayScore()),this.$$("max-score-label").html(e.get("maxScore")),this.$$("passing-percent-label").html(e.getDisplayPassingPercent()),this.$$("percent-score-label").html(e.getHumanPercentScore())},renderExamEvaluation:function renderExamEvaluation(){var e=this.model.get("evaluation"),s=this.model.get("gradingAttempt"),o=s.get("attemptState");if(!e)return;var i=e.isPassed(),l=i?"passed":"not-passed";i?this.$$("exam-header").removeClass("c-exam-not-passed").addClass("c-exam-passed"):this.$$("exam-header").removeClass("c-exam-passed").addClass("c-exam-not-passed"),this.$("[data-passing-state]").hide(),this.$('[data-passing-state~="'+l+'"]').show();var r=void 0,t={none:"none",unverified:"unverified",pending:"pending"};if(this.verificationDisplay.shouldPromptForVerification()&&i){var m=_([[s.attemptStates.none,t.none],[s.attemptStates.unverified,t.unverified],[s.attemptStates.pending,t.pending],[s.attemptStates.verified,t.none]]).object();r=m[o]}else r=t.none;this.$("[data-verification-warning]").hide(),this.$('[data-verification-warning~="'+r+'"]').show(),r===t.none?this.$$("exam-header").removeClass("c-exam-verification-warning"):this.$$("exam-header").addClass("c-exam-verification-warning"),this.$$("passing-percent-label").html(e.getDisplayPassingPercent()),this.$$("num-points-earned-label").html(e.getDisplayScore()),this.$$("max-score-label").html(e.get("maxScore")),this.$$("percent-score-label").html(e.getHumanPercentScore()),this.verificationDisplay.showCCAdvertising()&&i&&(this.$$("vc-upsell").show(),n.getPriceForVC({courseId:this.metadata.get("course").get("id")}).then(function(e){this.renderReactInto(a,"ReactPriceDisplay",{value:e.getDisplayAmount(),currency:e.getDisplayCurrencyCode()})}.bind(this)).fail(function(e){if(!e.responseJSON)throw e}).done()),this.renderCourseCompleteModal()}});module.exports=c});