define("bundles/asset-admin/actions/AssetAdminActions",["require","exports","module","underscore","js/lib/AssetManager","bundles/asset-admin/utils/AssetAdminAPIUtils","bundles/asset-admin/utils/AssetUploaderUtils","bundles/asset-admin/constants/UploadStatus","bundles/asset-admin/utils/AssetAdminTracking"],function(require,exports,module){"use strict";var _=require("underscore"),n=require("js/lib/AssetManager"),e=require("bundles/asset-admin/utils/AssetAdminAPIUtils"),t=require("bundles/asset-admin/utils/AssetUploaderUtils"),i=require("bundles/asset-admin/constants/UploadStatus"),a=require("bundles/asset-admin/utils/AssetAdminTracking"),s={initializeModal:function initializeModal(i,t){return e.getCourse(t.courseId).then(function(n){i.dispatch("INITIALIZED",{course:n.elements[0],noticeDismissed:e.isNoticeDismissed()}),t.hideAssets||s.getAssetsListByCourse(i,t)})},initializePage:function initializePage(t,i){t.dispatch("INITIALIZED",{noticeDismissed:e.isNoticeDismissed()}),s.getAssetsListByCourse(t,{courseId:i.courseId,fetchUrls:!0})},getAssetsListByCourse:function getAssetsListByCourse(s,t){var i=!t.nextPageIndex;return i&&s.dispatch("START_RECEIVING_ASSETS"),e.getAssetsListByCourse(t).then(function(a){var e=a.elements,r=a.paging.next;if(t.fetchUrls){var o=_(e).pluck("id"),d=new n;d.getAssetURLMap(o).then(function(t){s.dispatch("RECEIVED_ASSETS_LIST",{assets:e,nextPageIndex:r,urlMap:t,isInitialFetch:i})})}else s.dispatch("RECEIVED_ASSETS_LIST",{assets:e,nextPageIndex:r,isInitialFetch:i})})["catch"]()},selectAsset:function selectAsset(s,e){s.dispatch("SELECT_ASSET",e)},resetAssets:function resetAssets(s){s.dispatch("RESET_ASSETS")},openFileBrowser:function openFileBrowser(){t.openFileBrowser()},initializeUploader:function initializeUploader(n,r){var o=t.initialize(n,r),d=function onChange(e){t.startUpload(),s.updateUploadProgress(n,{state:i.IN_PROGRESS,files:e,progress:0})},u=function onProgress(e){s.updateUploadProgress(n,{state:i.IN_PROGRESS,progress:t.getProgressPercentage(e)})},c=function onAllComplete(t){if(_(t.error).isEmpty()&&!_(t.success).isEmpty()){var d=_(t.success).pluck("attemptId");e.getAssetsById(r.courseId,d).then(function(e){s.updateUploadProgress(n,{state:i.SUCCESS,progress:100,uploadedAssets:e.elements})})}else if(s.updateUploadProgress(n,{state:i.FAILED,progress:100,uploadAttempts:t}),!_(t.error).isEmpty()){var o={course_id:r.courseId,error:JSON.stringify(t)};r.assetType&&(o.asset_type=r.assetType),a.track("upload","failed",o)}};o.on("change",d),o.on("progress",u),o.on("all-complete",c)},updateUploadProgress:function updateUploadProgress(s,e){s.dispatch("UPLOAD_STATUS_UPDATED",e)},deleteAsset:function deleteAsset(i,t){var n=t.assetIds,a=t.courseId;e.deleteAssets(n).then(function(){s.getAssetsListByCourse(i,{courseId:a,fetchUrls:!0})})},dismissNotice:function dismissNotice(s){e.dismissNotice(),s.dispatch("NOTICE_MESSAGE_DISMISSED")}};module.exports=s});