define("bundles/CMLConverter/HTMLToCMLConverter",["require","exports","module","underscore","./CMLParser","./HTMLToCMLConverter/Text","./HTMLToCMLConverter/Code","./HTMLToCMLConverter/Image","./HTMLToCMLConverter/Table","./HTMLToCMLConverter/Asset","./HTMLToCMLConverter/Heading","./HTMLToCMLConverter/List"],function(require,exports,module){"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var c=function(){function defineProperties(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(e,r,n){return r&&defineProperties(e.prototype,r),n&&defineProperties(e,n),e}}(),_=require("underscore"),s=require("./CMLParser"),t=require("./HTMLToCMLConverter/Text"),o=require("./HTMLToCMLConverter/Code"),a=require("./HTMLToCMLConverter/Image"),i=require("./HTMLToCMLConverter/Table"),n=require("./HTMLToCMLConverter/Asset"),e=require("./HTMLToCMLConverter/Heading"),r=require("./HTMLToCMLConverter/List"),L=r.OrderedList,l=r.UnorderedList,C=function getBlock(s,r){var c=null,C=r.tagName&&r.tagName.toLowerCase();switch(C){case"p":c=new t(s,r);break;case"h1":c=new e(s,r,1);break;case"h2":c=new e(s,r,2);break;case"h3":c=new e(s,r,3);break;case"pre":c=new o(s,r);break;case"ol":c=new L(s,r);break;case"ul":c=new l(s,r);break;case"figure":c=new a(s,r);break;case"table":c=new i(s,r);break;case"div":if("asset"!==r.getAttribute("data-block-type"))throw new Error('Unsupported HTML element "'+r+", "+C+'"');c=new n(s,r);break;default:throw new Error('Unsupported HTML element "'+r+", "+C+'"')}return c},u=function(){function HTMLToCMLConverter(){_classCallCheck(this,HTMLToCMLConverter)}return c(HTMLToCMLConverter,[{key:"toCML",value:function toCML(n,t){var o=new window.DOMParser,a=HTMLToCMLConverter.sanitizeHTML(n),e=o.parseFromString("<body>"+a+"</body>","application/xml"),i=e.childNodes[0].childNodes,r=e.createElement("wrapper");return _(i).each(function(t){var n=C(e,t);n&&r.appendChild(n.block)}),HTMLToCMLConverter.getStringifiedCML(r,t)}}],[{key:"sanitizeHTML",value:function sanitizeHTML(e){return e.replace(/&nbsp;/gi," ").replace(/<br[\/]*\>/g,"\n").replace(/target=\"_blank\"/g,"").replace(/rel=\"noopener\"/g,"").replace(/rel=\"noopener nofollow\"/g,"").replace(/(<img("[^"]*"|[^\/">])*)>/g,"$1/>").replace(/(<source("[^"]*"|[^\/">])*)>/g,"$1/>")}},{key:"getStringifiedCML",value:function getStringifiedCML(r,n){var e=s.getInnerContent(r);if(n)return"<co-content>"+e+"</co-content>";return e}}]),HTMLToCMLConverter}();module.exports=u});