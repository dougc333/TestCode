define("js/lib/jquery.phoenixWebcam",["require","exports","module","js/vendor/backbone.v1-1-2","jquery","underscore","css!pages/signature/styl/jquery.phoenixWebcam.css"],function(require,exports,module){function getFlipCSS(e){var t=e&&e.mirror?"scaleX(-1)":"";return{"-moz-transform":t,"-o-transform":t,"-webkit-transform":t,"-ms-transform":t,transform:t}}var Backbone=require("js/vendor/backbone.v1-1-2"),$=require("jquery"),_=require("underscore");require("css!pages/signature/styl/jquery.phoenixWebcam.css");var s="data:image/png;base64,",o=1200;navigator.courseraGetUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var i=void 0!==navigator.courseraGetUserMedia,e={deblocking:0,smoothing:0,StageScaleMode:"noScale",cameraClassAndId:"c-signature-webcam-swfObject",ieVideoObjectClassId:"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",callTarget:"webcam",bgcolor:"#000000",isClientReady:function(){return!0},cameraConnected:function(){var t=document.getElementById(this.cameraClassAndId);void 0===this.save&&(this.save=function(){try{return t.save()}catch(e){this.swfApiFail(e)}},this.setCamera=function(e){try{return t.setCamera(e)}catch(a){this.swfApiFail(a)}},this.getCameraList=function(){try{return t.getCameraList()}catch(e){this.swfApiFail(e)}},this.getResolution=function(){try{return t.getResolution()}catch(e){this.swfApiFail(e)}})},initFlash:function(s,a){_.isObject(a)&&_(e).extend(_(a).pick(_(e).keys()));var o=["callTarget","resolutionWidth","resolutionHeight","smoothing","deblocking","StageScaleMode"],n=_(o).chain().map(function(t){return t+"="+this[t]}.bind(this)).join("&").value(),i='<param name="movie" value="'+this.swfFile+'" /><param name="FlashVars" value="'+n+'" /><param name="allowScriptAccess" value="always" /><param name="bgcolor" value="'+this.bgcolor+'" /><param name="wmode" value="transparent"/>',t;return t=_(window.ActiveXObject).isUndefined()?$("<object />").attr({"class":this.cameraClassAndId,id:this.cameraClassAndId,type:"application/x-shockwave-flash",data:this.swfFile}).append($(i)):$("<object>"+i+"</object>").attr({classid:this.ieVideoObjectClassId,"class":this.cameraClassAndId,type:"application/x-shockwave-flash",id:this.cameraClassAndId,width:this.resolutionWidth,height:this.resolutionHeight}),$(s).append(t),t}},a={initializeDefaults:{swfFile:"",cameraEnabledCallback:$.noop,cameraDisabledCallback:$.noop,swfApiFailCallback:$.noop,noCameraFoundCallback:$.noop,destroyCameraCallback:$.noop,newWebcamCallback:$.noop,error:$.noop,resolutionWidth:640,resolutionHeight:480,useHTML5:i,constraintImg:null,constraintImgHalf:null,constraintImgWidthPercent:0,constraintImgMarginPercent:0,successImg:null,errorImg:null},getWebcamPlugin:function(i,a){var e=$(i).data("webcam");return e&&e.constructor===t.prototype.constructor?a?e._customize(a):e:null},makeWebcamPlugin:function(s){var i=$(s),e=a.getWebcamPlugin(i);return e||(e=new t(i),i.data("webcam",e)),e},checkInitializeOptions:function(t){if(""===t.swfFile)return t.error("There was an error in initializing the webcam: no SWF file provided."),!1;return!0}},t=function(t){this.$el=$(t)};t.prototype._createUIElements=function(){this.$el.css({position:"relative",width:this.options.resolutionWidth,height:this.options.resolutionHeight}),this.$constraintImageL=$('<img class="c-signature-webcam-constraints"/>'),this.$constraintImageR=$('<img class="c-signature-webcam-constraints"/>'),this.$videoElContainer=$('<div class="c-signature-webcam-video-container"/>').append(this.$constraintImageL).append(this.$constraintImageR).appendTo(this.$el),this.options.useHTML5?this._makeHTML5Camera():this._makeFlashCamera()},t.prototype._makeHTML5Camera=function(){this.$imageOverlay=$('<img class="c-signature-webcam-image"/>'),this.$imageOverlayCanvas=$("<canvas />").attr({"class":"c-signature-webcam-image",id:"image-overlay-canvas",width:this.options.resolutionWidth,height:this.options.resolutionHeight}),this.$videoElContainer.append(this.$imageOverlayCanvas).append(this.$imageOverlay),this.$video=$("<video autoplay/>").attr({"class":this.cameraClassAndId,id:"screenshot-video"})},t.prototype._makeFlashCamera=function(){this.$imageOverlay=$('<img class="c-signature-webcam-image"/>'),this.$videoElContainer.append(this.$imageOverlay)},t.prototype._updateConstraintImages=function(){this.options.constraintImgHalf?(this.$constraintImageL.css({left:this.options.constraintImgMarginPercent+"%",width:this.options.constraintImgWidthPercent+"%"}),this.$constraintImageR.css({left:100-this.options.constraintImgWidthPercent-this.options.constraintImgMarginPercent+"%",width:this.options.constraintImgWidthPercent+"%"}),this.$constraintImageR.css(getFlipCSS({mirror:!0})),this.$constraintImageL.attr("src",this.options.constraintImgHalf).show(),this.$constraintImageR.attr("src",this.options.constraintImgHalf).show()):this.options.constraintImg?(this.$constraintImageL.css({left:0,width:"100%"}),this.$constraintImageL.attr("src",this.options.constraintImg),this.$constraintImageR.hide()):(this.$constraintImageL.hide(),this.$constraintImageR.hide())},t.prototype._allowTakePhoto=function(){this._hideImageOverlay(),this._updateConstraintImages(),this.options.useHTML5||window.webcam.setCamera("0")},t.prototype._addFlashCallbacks=function(){var t=this;window.webcam.cameraEnabled=function(){t.isCameraEnabled||t._enableCamera()},window.webcam.cameraDisabled=function(){t._onCameraDisabled()},window.webcam.noCameraFound=function(){t._onNoCameraFound()},window.webcam.swfApiFail=function(){t.options.errorImg&&t._showImageOverlay(t.options.errorImg),t.options.swfApiFailCallback()}},t.prototype._setup=function(t){this.isCameraEnabled=!1,this._customize(t);var e=a.checkInitializeOptions(this.options);return e},t.prototype._initializeHTML5=function(){navigator.courseraGetUserMedia({video:!0},function(t){this.canActivate=!0,this.localMediaStream=t,this.$video.attr("src",window.URL.createObjectURL(t)).css("transform","rotateY(180deg)").css("-webkit-transform","rotateY(180deg)").css("-moz-transform","rotateY(180deg)").appendTo(this.$videoElContainer).show(),this._enableCamera()}.bind(this),function(t){this.options.errorImg&&this._showImageOverlay(this.options.errorImg),setTimeout(function(){this._onNoCameraFound()}.bind(this),400)}.bind(this))},t.prototype._initializeFlash=function(){this._addFlashCallbacks(),this.$video=window.webcam.initFlash(this.$videoElContainer,this.options),this.$video.show()},t.prototype._customize=function(t){return this.options=_.extend({},e,a.initializeDefaults,t),this},t.prototype._enableCamera=function(){this.isCameraEnabled=!0,this.options.cameraEnabledCallback(),this._activate()},t.prototype._onCameraDisabled=function(){this.isCameraEnabled=!1,this.options.cameraDisabledCallback()},t.prototype._onNoCameraFound=function(){this.isCameraEnabled=!1,this.options.noCameraFoundCallback()},t.prototype._cameraFlashEffect=function(){this.$cameraFlashOverlay=$('<div class="c-signature-webcam-flash-overlay"></div>').appendTo(this.$videoElContainer),this.$cameraFlashOverlay.animate({opacity:0},o,function(){this.remove()})},t.prototype._showCapturedImage=function(){if(this._cameraFlashEffect(),this.options.useHTML5){this.$imageOverlay.hide();var t=document.getElementById(this.$imageOverlayCanvas.attr("id")),e=t.getContext("2d");e.drawImage(document.getElementById(this.$video.attr("id")),0,0,t.width,t.height),this.$imageOverlayCanvas.show(),this.$imageOverlayCanvas.addClass("c-signature-bordered-webcam-photo")}else this.$imageOverlay.attr("src",this.imageData),this.$imageOverlay.show(),this.$imageOverlay.addClass("c-signature-bordered-webcam-photo")},t.prototype._showImageOverlay=function(t){this.options.useHTML5&&this.$imageOverlayCanvas.hide(),this.$imageOverlay.attr("src",t),this.$imageOverlay.show()},t.prototype._hideImageOverlay=function(){this.$imageOverlayCanvas&&this.$imageOverlayCanvas.hide(),this.$imageOverlay.hide()},t.prototype._html5Save=function(){if(!this.options.useHTML5)return"";var e=document.getElementById(this.$imageOverlayCanvas.attr("id")),a=e.getContext("2d");a.drawImage(document.getElementById(this.$video.attr("id")),0,0,e.width,e.height);var t=document.createElement("canvas");t.width=e.width/2,t.height=e.height/2;var i=t.getContext("2d");return i.drawImage(document.getElementById(this.$video.attr("id")),0,0,t.width,t.height),t.toDataURL("image/png")},t.prototype._activate=function(){if(!this.canActivate)return void this.options.error("Webcam not allowed to activate.");return this.canActivate=!1,this._allowTakePhoto(),this},t.prototype.initialize=function(t){this.originalSettings=_.extend({},t);var a=this._setup(t);if(a){if(window.webcam){if(window.webcam.cameraClassAndId!==e.cameraClassAndId)return this.options.error("Your webcam is being used by a separate program. Please close the program to continue."),this;this.destroy()}this.options.swfFile=this.options.swfFile+"?s="+(new Date).getSeconds(),window.webcam=this.options,this._createUIElements(),this.options.useHTML5?this._initializeHTML5():this._initializeFlash(),this.canActivate=!0}return this.options.newWebcamCallback(),this},t.prototype.isHTML5Supported=function(){return i},t.prototype.isCameraEnabled=function(){return this.isCameraEnabled},t.prototype.isUsingHTML5=function(){return this.options.useHTML5},t.prototype.takePhoto=function(t,e){if(this.options.useHTML5)this.imageData=this._html5Save();else{var a=window.webcam.save();this.imageData=a?s+a:""}this.imageData?(t&&t(this.imageData),this._showCapturedImage()):(this.options.error("There was an error in taking the photo. Please try again."),e&&e())},t.prototype.allowRetake=function(){this._allowTakePhoto()},t.prototype.toggleDriver=function(){this.isHTML5Supported()&&(this.originalSettings.useHTML5=!this.isUsingHTML5(),this.destroy(),this.initialize(this.originalSettings))},t.prototype.destroy=function(){this.localMediaStream&&this.localMediaStream.stop&&this.localMediaStream.stop(),this.localMediaStream&&this.localMediaStream.getTracks&&this.localMediaStream.getTracks().map(function(t){t.stop()}),this.isUsingHTML5()&&this.$video&&(this.$video[0]&&this.$video[0].pause&&this.$video[0].pause(),this.$video.attr("src","")),this.$el.find(".c-signature-webcam-video-container").remove(),window.webcam&&(window.webcam=null),this.isCameraEnabled=!1,this.options.destroyCameraCallback()},_.extend(t.prototype,Backbone.Events);var n=function(){return a.makeWebcamPlugin.apply(this,arguments)};module.exports=n});