define("bundles/videojs/plugins/resolutions",["require","exports","module","videojs","underscore","js/app/loggerSingleton","js/app/config"],function(require,exports,module){"use strict";var t=require("videojs"),_=require("underscore"),o=require("js/app/loggerSingleton"),s=require("js/app/config"),e=function ResolutionsHandler(t,e){this.player=t,this.sourcesByResolution=e.sourcesByResolution,this.supportedResolutions=_(this._knownResolutions).intersection(_(e.sourcesByResolution).keys()),this.resolution=this.isResolutionSupported(e.resolution)?e.resolution:"540p",this.possibleResolutions=this.supportedResolutions,this.player.on("error",function(){var e=this.player.error();if(e&&4===e.code&&"testing"!==s.environment){o.error("Attempted to get source for resolution, but server responded with an error");var t=this.getResolution();this.possibleResolutions=_(this.possibleResolutions).without(t),this.possibleResolutions.length&&this.setResolution(this.possibleResolutions[0])}}.bind(this))};e.prototype.getResolution=function(){return this.resolution},e.prototype.getResolutionIndex=function(){return _(this.supportedResolutions).indexOf(this.resolution)},e.prototype.isResolutionSupported=function(e){return _(this.supportedResolutions).contains(e)},e.prototype.getSourceForResolution=function(e){if(!this.isResolutionSupported(e))return void o.error("Attempted to get source for unsupported resolution");var t=_(this.sourcesByResolution[e]).findWhere({type:"video/mp4"});return t&&t.src},e.prototype.setResolution=function(e){if(this.resolution===e)return;if(!this.isResolutionSupported(e))return;var o=this.player.currentTime(),t=this.player.playbackRate(),s=this.player.paused();this.player.pause(),this.player.one("loadedmetadata",function(){this.player.currentTime(o),this.player.options().playbackRates&&this.player.playbackRate(t),s?this.player.pause():this.player.play()}.bind(this)),this.player.src(this.sourcesByResolution[e]),this.resolution=e,this.player.trigger("resolutionchange")},e.prototype.decreaseResolution=function(){if(0===this.supportedResolutions.length||this.getResolution===_(this.supportedResolutions).first())return;this.setResolution(this.supportedResolutions[this.getResolutionIndex()-1])},e.prototype.increaseResolution=function(){if(0===this.supportedResolutions.length||this.resolution===_(this.supportedResolutions).last())return;this.setResolution(this.supportedResolutions[this.getResolutionIndex()+1])},e.prototype._knownResolutions=["360p","540p","720p"],t.plugin("resolutions",function(t){var o=this;this.resolutionsHandler_||!function(){var s=new e(o,t);o.resolutionsHandler_=s,o.resolution=function(e){return e?(s.setResolution(e),e):s.getResolution()},o.increaseResolution=s.increaseResolution.bind(s),o.decreaseResolution=s.decreaseResolution.bind(s),o.isResolutionSupported=s.isResolutionSupported.bind(s),o.getResolutionIndex=s.getResolutionIndex.bind(s),o.getSourceForResolution=s.getSourceForResolution.bind(s)}()})});