(function(){"use strict";function e(e,t,n,i){e.addEventListener(t,n,i||!1)}function t(e,t,n,i){e.removeEventListener(t,n,i||!1)}function n(e){return e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,!1}function i(e){var t=e.getElementsByTagName("body")[0],n=e.createElement("span");n.innerHTML="hello world",t.appendChild(n);var i=n.scrollWidth;n.style.fontWeight="bold";var o=n.scrollWidth;return t.removeChild(n),i!==o}function o(e,t){for(var n=e.length;n--;)if(e[n]===t)return n;return-1}function r(e,t,n){var i=e<<16|t<<8|n;if(null!=r._cache[i])return r._cache[i];for(var o,s,a,l,c,u=1/0,h=-1,d=0;d<Terminal.vcolors.length;d++){if(o=Terminal.vcolors[d],s=o[0],a=o[1],l=o[2],c=r.distance(e,t,n,s,a,l),0===c){h=d;break}u>c&&(u=c,h=d)}return r._cache[i]=h}Terminal.bindPaste=function(t){var i=t.defaultView;e(i,"paste",function(e){console.log("paste");var t=Terminal.focus;if(t&&(t.isMac||!Terminal.pasteMode||!t.pasteFlag))return e.clipboardData?t.handler(e.clipboardData.getData("text/plain")):t.context.clipboardData&&t.handler(t.context.clipboardData.getData("Text")),t.element.contentEditable="inherit",n(e)})},Terminal.bindKeys=function(t){function n(e){var t=e.target||e.srcElement;if(Terminal.focus&&t&&(t===Terminal.focus.element||t===Terminal.focus.context||t===Terminal.focus.document||t===Terminal.focus.body||t===Terminal._textarea||t===Terminal.focus.parent)){if("keydown"===e.type)return Terminal.focus.keyDown(e);if("keypress"===e.type)return Terminal.focus.keyPress(e)}}e(t,"keydown",n),e(t,"keypress",n),e(t,"mousedown",function(e){if(Terminal.focus){var t=e.target||e.srcElement;if(t){do if(t===Terminal.focus.element)return;while(t=t.parentNode);Terminal.focus.blur()}}})},Terminal.bindCopy=function(t){var n=t.defaultView;e(n,"copy",function(e){console.log("weird copy");var t=Terminal.focus;if(t&&t._selected){var n=t.getCopyTextarea(),i=t.grabText(t._selected.x1,t._selected.x2,t._selected.y1,t._selected.y2);t.emit("copy",i),n.focus(),n.textContent=i,n.value=i,n.setSelectionRange(0,i.length),a(function(){t.element.focus(),t.focus()},1)}})},Terminal.prototype.bindMouse=function(){function i(e){var t,n;if(t=l(e),n=c(e))switch(a(t,n),e.type){case"mousedown":d=t;break;case"mouseup":d=32;break;case f:}}function o(e){var t,n=d;t=c(e),t&&(n+=32,a(n,t))}function r(e,t){if(h.utfMouse){if(2047===t)return e.push(0);127>t?e.push(t):(t>2047&&(t=2047),e.push(192|t>>6),e.push(128|63&t))}else{if(255===t)return e.push(0);t>127&&(t=127),e.push(t)}}function a(e,t){if(h.vt300Mouse){e&=3,t.x-=32,t.y-=32;var n="[24";if(0===e)n+="1";else if(1===e)n+="3";else if(2===e)n+="5";else{if(3===e)return;n+="0"}return n+="~["+t.x+","+t.y+"]\r",void h.send(n)}if(h.decLocator)return e&=3,t.x-=32,t.y-=32,0===e?e=2:1===e?e=4:2===e?e=6:3===e&&(e=3),void h.send("["+e+";"+(3===e?4:0)+";"+t.y+";"+t.x+";"+(t.page||0)+"&w");if(h.urxvtMouse)return t.x-=32,t.y-=32,t.x++,t.y++,void h.send("["+e+";"+t.x+";"+t.y+"M");if(h.sgrMouse)return t.x-=32,t.y-=32,void h.send("[<"+(3===(3&e)?-4&e:e)+";"+t.x+";"+t.y+(3===(3&e)?"m":"M"));var n=[];r(n,e),r(n,t.x),r(n,t.y),h.send("[M"+s.fromCharCode.apply(s,n))}function l(e){var t,n,i,o,r;switch(e.type){case"mousedown":t=null!=e.button?+e.button:null!=e.which?e.which-1:null,h.isMSIE&&(t=1===t?0:4===t?1:t);break;case"mouseup":t=3;break;case"DOMMouseScroll":t=e.detail<0?64:65;break;case"mousewheel":t=e.wheelDeltaY>0?64:65}return n=e.shiftKey?4:0,i=e.metaKey?8:0,o=e.ctrlKey?16:0,r=n|i|o,h.vt200Mouse?r&=o:h.normalMouse||(r=0),t=32+(r<<2)+t}function c(e){var t,n,i,o,r;if(null!=e.pageX){for(t=e.pageX,n=e.pageY,r=h.element;r&&r!==h.document.documentElement;)t-=r.offsetLeft,n-=r.offsetTop,r="offsetParent"in r?r.offsetParent:r.parentNode;return i=h.element.clientWidth,o=h.element.clientHeight,t=Math.round(t/i*h.cols),n=Math.round(n/o*h.rows),0>t&&(t=0),t>h.cols&&(t=h.cols),0>n&&(n=0),n>h.rows&&(n=h.rows),t+=32,n+=32,{x:t,y:n,type:e.type===f?"mousewheel":e.type}}}var u=this.element,h=this,d=32,f="onmousewheel"in this.context?"mousewheel":"DOMMouseScroll";e(u,"mousedown",function(r){return h.mouseEvents?(i(r),h.focus(),h.vt200Mouse?(i({__proto__:r,type:"mouseup"}),n(r)):(h.normalMouse&&e(h.document,"mousemove",o),h.x10Mouse||e(h.document,"mouseup",function s(e){return i(e),h.normalMouse&&t(h.document,"mousemove",o),t(h.document,"mouseup",s),n(e)}),n(r))):void 0}),e(u,f,function(e){return h.mouseEvents&&!(h.x10Mouse||h.vt300Mouse||h.decLocator)?(i(e),n(e)):void 0}),e(u,f,function(e){var t=2;if(!h.mouseEvents&&!h.applicationKeypad)return"DOMMouseScroll"===e.type?h.scrollDisp(e.detail<0?-t:t):h.scrollDisp(e.wheelDeltaY>0?-t:t),n(e)})},Terminal.prototype.interceptEvent=function(e,t){var n={};for(var i in e)"keyLocation"!=i&&(n[i]=e[i]);if(this.isMac&&"escape"===(GlobalHotkeyManager.keySettings&&GlobalHotkeyManager.keySettings.altBehavior)){18===(n.charCode||n.keyCode||n.which);"press"===t&&n.altKey&&(n.altKey=!1,this.handler("")),n.charCode in this.altKeyMapping&&(n.charCode=this.altKeyMapping[n.charCode]),n.keyCode in this.altKeyMapping&&(n.keyCode=this.altKeyMapping[n.keyCode]),n.which in this.altKeyMapping&&(n.which=this.altKeyMapping[n.which])}return n},Terminal.prototype.keyDown=function(e){var t,i=e;switch(e=this.interceptEvent(i,"down"),e.keyCode){case 8:if(e.shiftKey){t="\b";break}t="";break;case 9:if(e.shiftKey){t="[Z";break}t="	";break;case 13:t="\r";break;case 27:t="";break;case 37:if(this.applicationCursor){t="OD";break}t="[D";break;case 39:if(this.applicationCursor){t="OC";break}t="[C";break;case 38:if(this.applicationCursor){t="OA";break}if(e.ctrlKey)return this.scrollDisp(-1),n(i);t="[A";break;case 40:if(this.applicationCursor){t="OB";break}if(e.ctrlKey)return this.scrollDisp(1),n(i);t="[B";break;case 46:t="[3~";break;case 45:t="[2~";break;case 36:if(this.applicationKeypad){t="OH";break}t="OH";break;case 35:if(this.applicationKeypad){t="OF";break}t="OF";break;case 33:if(!this.normal)return this.scrollDisp(-(this.rows-1)),n(i);t="[5~";break;case 34:if(!this.normal)return this.scrollDisp(this.rows-1),n(i);t="[6~";break;case 112:t="OP";break;case 113:t="OQ";break;case 114:t="OR";break;case 115:t="OS";break;case 116:t="[15~";break;case 117:t="[17~";break;case 118:t="[18~";break;case 119:t="[19~";break;case 120:t="[20~";break;case 121:t="[21~";break;case 122:t="[23~";break;case 123:t="[24~";break;default:if(e.ctrlKey)if(e.keyCode>=65&&e.keyCode<=90){if(86===e.keyCode&&!this.isMac){if(!Terminal.pasteMode)return;if(1===Terminal.pasteMode&&e.shiftKey)return;var o=this;o.pasteFlag=!0,a(function(){o.pasteFlag=!1},100)}if(67===e.keyCode&&this.copyFlag&&!this.isMac)return;t=s.fromCharCode(e.keyCode-64)}else 32===e.keyCode||e.shiftKey&&50===e.keyCode?t=s.fromCharCode(0):e.keyCode>=51&&e.keyCode<=55?t=s.fromCharCode(e.keyCode-51+27):56===e.keyCode?t=s.fromCharCode(127):189===e.keyCode?t=s.fromCharCode(31):219===e.keyCode?t=s.fromCharCode(27):220===e.keyCode?t=s.fromCharCode(28):221===e.keyCode&&(t=s.fromCharCode(29));else{if(e.altKey)return!0;if(e.metaKey&&this.isMac&&(38===e.keyCode||40===e.keyCode))return this.scrollDisp((e.keyCode-39)*(this.rows-1)),n(i)}}return t?this.prefixMode?(this.leavePrefix(),n(i)):this.selectMode?(this.keySelect(e,t),n(i)):(this.emit("keydown",e),this.emit("key",t,e),this.showCursor(),this.handler(t),n(i)):!0},Terminal.prototype.keyPress=function(e){var t,i=e;if(e=this.interceptEvent(i,"press"),n(i),e.charCode)t=e.charCode;else if(null==e.which)t=e.keyCode;else{if(0===e.which||0===e.charCode)return!1;t=e.which}return!t||e.ctrlKey||e.altKey||e.metaKey?!1:(t=s.fromCharCode(t),this.prefixMode?(this.leavePrefix(),this.keyPrefix(e,t),!1):this.selectMode?(this.keySelect(e,t),!1):(this.emit("keypress",t,e),this.emit("key",t,e),this.showCursor(),this.handler(t),!1))},Terminal.focus=null,Terminal.prototype.focus=function(){Terminal.focus!==this&&(Terminal.focus&&Terminal.focus.blur(),this.sendFocus&&this.send("[I"),this.showCursor(),Terminal.focus=this)},Terminal.prototype.blur=function(){Terminal.focus===this&&(this.cursorState=0,this.refresh(this.y,this.y),this.sendFocus&&this.send("[O"),Terminal.focus=null)},Terminal.prototype.initGlobal=function(){var e=this.document;Terminal._boundDocs=Terminal._boundDocs||[],~o(Terminal._boundDocs,e)||(Terminal._boundDocs.push(e),Terminal.bindPaste(e),Terminal.bindKeys(e),Terminal.bindCopy(e),this.isIpad&&Terminal.fixIpad(e),this.useStyle&&Terminal.insertStyle(e,this.colors[256],this.colors[257]))},Terminal.insertStyle=function(e,t,n){var i=e.getElementById("term-style");if(!i){var o=e.getElementsByTagName("head")[0];if(o){var i=e.createElement("style");i.id="term-style",i.innerHTML=".terminal {\n  float: left;\n  border: "+t+' solid 5px;\n  font-family: "DejaVu Sans Mono", "Liberation Mono", monospace;\n  font-size: 11px;\n  color: '+n+";\n  background: "+t+";\n  line-height: normal !important;\n}\n\n.terminal-cursor {\n  color: "+t+";\n  background: "+n+";\n}\n",o.insertBefore(i,o.firstChild)}}},Terminal.fixIpad=function(e){console.log("fixIpad");var t=e.createElement("textarea");t.style.position="absolute",t.style.left="-32000px",t.style.top="-32000px",t.style.width="0px",t.style.height="0px",t.style.opacity="0",t.style.backgroundColor="transparent",t.style.borderStyle="none",t.style.outlineStyle="none",e.getElementsByTagName("body")[0].appendChild(t),Terminal._textarea=t},Terminal.prototype.altKeyMapping={161:49,8482:50,163:51,162:52,8734:53,167:54,182:55,8226:56,170:57,186:48,8211:45,8800:61,8721:119,174:114,8224:116,165:121,248:111,960:112,8220:91,8216:93,171:92,229:97,223:115,8706:100,402:102,169:103,729:104,8710:106,730:107,172:108,230:39,937:122,8776:120,231:99,8730:118,8747:98,181:109,8804:44,8805:46,247:47},Terminal.prototype.show=function(){this.element&&(this.element.style.display="block")},Terminal.prototype.open=function(t,n){var o,r=this;if(this.parent=t||this.parent,!this.parent)throw new Error("Terminal requires a parent element.");this.context=this.parent.ownerDocument.defaultView,this.document=this.parent.ownerDocument,this.body=this.document.getElementsByTagName("body")[0],this.context.navigator&&this.context.navigator.userAgent&&(this.isMac=!!~this.context.navigator.userAgent.indexOf("Mac"),this.isIpad=!!~this.context.navigator.userAgent.indexOf("iPad"),this.isMSIE=!!~this.context.navigator.userAgent.indexOf("MSIE")),this.element=this.document.createElement("div"),this.element.className="terminal",this.element.style.outline="none",n&&(this.element.style.display="none"),this.element.setAttribute("tabindex",0),this.element.style.backgroundColor=this.colors[256],this.element.style.color=this.colors[257],this.children=[];for(var s=0;s<this.rows;s++)o=this.document.createElement("div"),this.element.appendChild(o),this.children.push(o);this.parent.appendChild(this.element),this.refresh(0,this.rows-1),this.initGlobal(),n||this.focus(),this.startBlink(),e(this.element,"focus",function(){r.focus(),r.isIpad&&Terminal._textarea.focus()}),e(this.element,"mousedown",function(){document.getSelection().removeAllRanges(),r.focus()}),e(this.element,"mouseup",function(){var e=document.getSelection().toString();e?r.copyFlag=!0:r.copyFlag=!1}),e(this.element,"mousedown",function(e){var t=null!=e.button?+e.button:null!=e.which?e.which-1:null;r.isMSIE&&(t=1===t?0:4===t?1:t),2===t&&(r.element.contentEditable="true",a(function(){r.element.contentEditable="inherit"},1))},!0),this.bindMouse(),null==Terminal.brokenBold&&(Terminal.brokenBold=i(this.document)),a(function(){r.element.focus()},100)},Terminal.prototype.destroy=function(){this.readable=!1,this.writable=!1,this._events={},this.handler=function(){},this.write=function(){},this.element.parentNode&&this.element.parentNode.removeChild(this.element)};var s=this.String,a=this.setTimeout;this.setInterval;r._cache={},r.distance=function(e,t,n,i,o,r){return Math.pow(30*(e-i),2)+Math.pow(59*(t-o),2)+Math.pow(11*(n-r),2)},"undefined"!=typeof module?module.exports=Terminal:this.Terminal=Terminal}).call(function(){return this||("undefined"!=typeof window?window:global)}());