define("bundles/scribe-plugins/scribe-plugin-image-upload-command/ImageUtils",["require","exports","module","underscore","jquery"],function(require,exports,module){"use strict";function getFigure(n,t){var e=$("<figure>",{contentEditable:!0}),i=$("<img>",{src:t,"data-asset-id":n,draggable:!1});return e.append(i),e.get(0)}function showLoader(o){var i=$("<div>",{"class":n,html:"Uploading..."}),e=$(o.el),a=e.offset(),l=a.left+e.width()/2-30,c=a.top+e.height()/2;i.css({left:l,top:c}),e.addClass(t).attr("contenteditable",!1),$(document.body).append(i)}function hideLoader(e){var i=$(e.el);i.removeClass(t).attr("contenteditable",!0),$("."+n).remove()}var _=require("underscore"),$=require("jquery"),n="scribe-image-upload-command-loader",t="scribe-image-upload-command-in-progress",e={isImageBlock:function isImageBlock(e){return e&&"FIGURE"===e.nodeName},findBlockContainer:function findBlockContainer(n,e){for(;e&&!n.element.isBlockElement(e);)e=e.parentNode;return e},select:function select(t,i){var n=new t.api.Selection,e=n.range;e||(e=document.createRange()),$(i).addClass("selected"),e.selectNode(i.childNodes[0]),n.selection.removeAllRanges(),n.selection.addRange(e),t.trigger("content-changed")},insertImage:function insertImage(n,e,t){var i=this;e.isInitialized()||(e.initializeImageUploader(t),e.once("select",function(){i.uploadImage(n,e)})),e.selectFile()},uploadImage:function uploadImage(e,n){var t=this;showLoader(e),n.upload().then(function(a){var i=a.id;return n.getAssetURLMap([i]).then(function(n){t.injectImage(e,i,n[i])})})["finally"](function(){hideLoader(e),n.destroyUploader()})},injectImage:function injectImage(n,t,i){n.transactionManager.run(function(){var c=new n.api.Selection,r=c.range,a=e.findBlockContainer(n,r.endContainer),d=_(n.el.childNodes).indexOf(a)+1,o=a.nextSibling,l=getFigure(t,i);o?n.el.insertBefore(l,o):(n.el.appendChild(l),n.el.appendChild(document.createElement("p"))),setTimeout(function(){e.select(n,n.el.childNodes[d])},100)})},cleanupSelection:function cleanupSelection(e){$("figure.selected",e.el).removeClass("selected")}};module.exports=e});