define("bundles/CMLConverter/HTMLToCMLConverter",["require","exports","module","underscore","./CMLParser","./HTMLToCMLConverter/Text","./HTMLToCMLConverter/Code","./HTMLToCMLConverter/Image","./HTMLToCMLConverter/Table","./HTMLToCMLConverter/Asset","./HTMLToCMLConverter/Heading","./HTMLToCMLConverter/List"],function(require,exports,module){"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var s=function(){function defineProperties(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(e,r,n){return r&&defineProperties(e.prototype,r),n&&defineProperties(e,n),e}}(),_=require("underscore"),n=require("./CMLParser"),T=require("./HTMLToCMLConverter/Text"),L=require("./HTMLToCMLConverter/Code"),i=require("./HTMLToCMLConverter/Image"),l=require("./HTMLToCMLConverter/Table"),c=require("./HTMLToCMLConverter/Asset"),r=require("./HTMLToCMLConverter/Heading"),o=require("./HTMLToCMLConverter/List"),a=o.OrderedList,C=o.UnorderedList,e=n.getBlockTypes(),u=[e.Heading,e.Text,e.Image,e.Table,e.List,e.Code,e.Asset],M=function getBlock(t,e){var n=null,o=e.tagName&&e.tagName.toLowerCase();switch(o){case"p":n=new T(t,e);break;case"h1":n=new r(t,e,1);break;case"h2":n=new r(t,e,2);break;case"h3":n=new r(t,e,3);break;case"pre":n=new L(t,e);break;case"ol":n=new a(t,e);break;case"ul":n=new C(t,e);break;case"figure":n=new i(t,e);break;case"table":n=new l(t,e);break;case"div":if("asset"!==e.getAttribute("data-block-type"))throw new Error('Unsupported HTML element "'+e+", "+o+'"');n=new c(t,e);break;default:throw new Error('Unsupported HTML element "'+e+", "+o+'"')}return n},t=function(){function HTMLToCMLConverter(){_classCallCheck(this,HTMLToCMLConverter)}return s(HTMLToCMLConverter,[{key:"toCML",value:function toCML(n,t){var o=new window.DOMParser,a=HTMLToCMLConverter.sanitizeHTML(n),e=o.parseFromString("<body>"+a+"</body>","application/xml"),i=e.childNodes[0].childNodes,r=e.createElement("wrapper");return _(i).each(function(t){var n=M(e,t);n&&r.appendChild(n.block)}),HTMLToCMLConverter.getStringifiedCML(r,t)}}],[{key:"sanitizeHTML",value:function sanitizeHTML(e){return e.replace(/&nbsp;/gi," ").replace(/<br[\/]*\>/g,"\n").replace(/target=\"_blank\"/g,"").replace(/rel=\"noopener\"/g,"").replace(/rel=\"noopener nofollow\"/g,"").replace(/(<img("[^"]*"|[^\/">])*)>/g,"$1/>").replace(/(<source("[^"]*"|[^\/">])*)>/g,"$1/>")}},{key:"getStringifiedCML",value:function getStringifiedCML(r,t){var e=n.getInnerContent(r);if(t)return"<co-content>"+e+"</co-content>";return e}}]),HTMLToCMLConverter}();Object.assign(t,{SUPPORTED_BLOCKS:u}),module.exports=t});