define("bundles/assess/questionTypes/shortanswer/student/view",["require","exports","module","underscore","bundles/assess/questionTypes/shortanswer/student/correctAnswers.html","bundles/assess/questionTypes/shortanswer/student/template.html","bundles/phoenix/lib/renderContent","bundles/phoenix/lib/view"],function(require,exports,module){"use strict";var _=require("underscore"),s=require("bundles/assess/questionTypes/shortanswer/student/correctAnswers.html"),t=require("bundles/assess/questionTypes/shortanswer/student/template.html"),e=require("bundles/phoenix/lib/renderContent"),n=require("bundles/phoenix/lib/view"),r=n.extend({className:"coursera-assess-question-shortanswer",supportedStyles:["coursera-assess-style-question-default","coursera-assess-style-question-in-video"],events:{"click [data-show-correct-answers]":"showCorrectAnswers","keyup [data-shortanswer-response]":"onChangeInput","keydown [data-shortanswer-response]":"stopPropagation","keypress [data-shortanswer-response]":"stopPropagation","click [data-retry]":"retryQuestion"},initialize:function initialize(e){this.options=this.options||e||{},this.options._seeCorrectAnswers=!1},render:function render(){var s=this.options.instance,e=s.feedback,r=e&&e.definition&&e.definition.isCorrect,n=s.weightedScoring;if(this.$el.html(t({instance:s,feedback:e,isGraded:e&&"Graded"==e.feedbackLevel,isSubmitted:!!e,index:this.options.index,showFeedbackIcon:this.options.showFeedbackIcon,isCorrect:r,score:n?n.score:null,maxScore:n?n.maxScore:null})),s.localResponse){var i=s.localResponse.answer;this.$("[data-shortanswer-response]").val(i)}r?(this.$el.removeClass("c-incorrect"),this.$el.addClass("c-correct")):(this.$el.removeClass("c-correct"),this.$el.addClass("c-incorrect")),this.renderReactViews(),this.renderCorrectAnswersSection()},renderReactViews:function renderReactViews(){var t=this.options.instance,s=this.options.instance.feedback;e(t.variant.definition.prompt,this.$$("prompt")),e(s&&s.definition.display,this.$$("feedback-display"))},renderCorrectAnswersSection:function renderCorrectAnswersSection(){this.options.instance.feedback&&(this.$("[data-shortanswer-correct-answers-list]").html(s({isCorrect:this.options.instance.feedback.definition.isCorrect,correctAnswers:this.getOtherCorrectAnswers(),seeCorrectAnswers:this.options._seeCorrectAnswers})),this.renderCorrectAnswersSectionReactViews())},renderCorrectAnswersSectionReactViews:function renderCorrectAnswersSectionReactViews(){var s=this;this.getOtherCorrectAnswers().forEach(function(t){var n=s.$$("correct-answer-feedback-display").filter('[data-correct-answer-id="'+t.id+'"]');n.length>0&&e(t.feedback,n)})},retryQuestion:function retryQuestion(){this.options.instance.localResponse=null,this.options.instance.feedback=null,this.render()},disableInput:function disableInput(){this.$("input").attr("disabled",!0),this.$$("try-again-link-container").hide()},enableInput:function enableInput(){this.$("input").attr("disabled",!1),this.$$("try-again-link-container").show()},getResponse:function getResponse(){return this.$("[data-shortanswer-response]").val()},serializeResponse:function serializeResponse(){var e=this.getResponse();return{answer:e}},isAnswered:function isAnswered(){return this.getResponse()&&this.getResponse().trim().length>0},transform:function transform(e){return e.trim().toLowerCase()},stopPropagation:function stopPropagation(e){e.stopPropagation()},onChangeInput:function onChangeInput(e){this.stopPropagation(e),this.trigger("change"),13===e.keyCode&&this.trigger("submit")},showCorrectAnswers:function showCorrectAnswers(){var e=this.$("[data-shortanswer-correct-answers-list]").offset().top-this.$("[data-prompt]").offset().top;this.options._seeCorrectAnswers=!0,this.renderCorrectAnswersSection(),this.$el.animate({scrollTop:e},500)},getOtherCorrectAnswers:function getOtherCorrectAnswers(){var e=this,s=[];return this.options.instance.feedback&&!function(){var t=e,n=t.transform(e.options.instance.effectiveResponse.response.answer);s=_(e.options.instance.feedback.definition.correctAnswers).filter(function(e){return n!==t.transform(e.answer)})}(),s}});module.exports=r});