define("pages/open-course/common/utils/ensureEnrolled",["require","exports","module","jquery","react-with-addons","react-dom","q","bundles/certificate-enroll/actions/EnrollActions","bundles/certificate-enroll/components/OpenCourseEnrollModal","bundles/s12n-enroll/components/StandaloneEnrollModal","bundles/ondemand/components/ContentRequiresEnrollModal","bundles/phoenix/template/models/userIdentity","pages/open-course/common/singletons/course","pages/open-course/common/singletons/courseMembership","pages/open-course/common/promises/membership","pages/open-course/common/singletons/s12n","pages/open-course/common/singletons/verificationDisplay"],function(require,exports,module){"use strict";var $=require("jquery"),e=require("react-with-addons"),s=require("react-dom"),n=require("q"),u=require("bundles/certificate-enroll/actions/EnrollActions"),i=require("bundles/certificate-enroll/components/OpenCourseEnrollModal"),t=require("bundles/s12n-enroll/components/StandaloneEnrollModal"),l=require("bundles/ondemand/components/ContentRequiresEnrollModal"),g=require("bundles/phoenix/template/models/userIdentity"),c=require("pages/open-course/common/singletons/course"),d=require("pages/open-course/common/singletons/courseMembership"),a=require("pages/open-course/common/promises/membership"),p=require("pages/open-course/common/singletons/s12n"),m=require("pages/open-course/common/singletons/verificationDisplay"),o=function UserRejectedEnrollPromptException(){},r=function ensureEnrolled(){return d.then(function(r){return r.hasEnrolledRole()?n():n.all([c,p.invoke("at",0),m]).spread(function(d,m,b){if(m&&b.get("productOwnership.owns"))return a(g.get("id"),d.get("id")).invoke("enroll");var r=n.defer(),p=$("<div></div>").appendTo("body"),c=void 0;return m?(c=e.createElement(t,{s12nId:m.get("id"),courseIdOverride:d.get("id"),showFreeOption:!m.get("membership").isEnrolled(),isContentGate:!0,onFail:r.reject.bind(r,new o),onEnroll:r.resolve}),s.render(c,p.get(0))):d.isCertificatePurchaseEnabled()?(0===$(".rc-PhoenixEnrollModal").length&&(c=e.createElement(i,{course:d}),s.render(c,p.get(0))),u.updateShowModal(!0)):(c=e.createElement(l,{course:d,onClose:r.reject.bind(r,new o)}),s.render(c,p.get(0))),r.promise["finally"](p.remove.bind(p))})})};r.UserRejectedEnrollPromptException=o,module.exports=r});