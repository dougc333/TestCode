define("pages/open-course/item/views/header",["require","exports","module","bundles/course-preview/components/JoinCourseBanner","bundles/ondemand/actions/S12nActions","bundles/ondemand/appContextSingleton","bundles/ondemand/components/sessions/SessionEnrollBanner","bundles/ondemand/sessions/lib/experiment","bundles/page/common/headerTypeToProps","bundles/page/components/PageHeader","bundles/phoenix/lib/multitrackerMixin","bundles/phoenix/lib/view","bundles/phoenix/template/models/userAuthorization","bundles/phoenix/template/models/userIdentity","bundles/page/lib/metatagsAddressBook","js/app/config","js/lib/coursera.redirect","js/lib/ReactRouterAdapter","js/lib/jade._h","pages/open-course/common/constants","pages/open-course/item/views/header.html"],function(require,exports,module){"use strict";var k=require("bundles/course-preview/components/JoinCourseBanner"),c=require("bundles/ondemand/actions/S12nActions"),u=c.loadS12n,n=require("bundles/ondemand/appContextSingleton"),o=require("bundles/ondemand/components/sessions/SessionEnrollBanner"),s=require("bundles/ondemand/sessions/lib/experiment").isSessionsEnabled,a=require("bundles/page/common/headerTypeToProps"),r=require("bundles/page/components/PageHeader"),d=require("bundles/phoenix/lib/multitrackerMixin"),l=require("bundles/phoenix/lib/view"),e=require("bundles/phoenix/template/models/userAuthorization"),t=require("bundles/phoenix/template/models/userIdentity"),m=require("bundles/page/lib/metatagsAddressBook"),p=require("js/app/config"),g=require("js/lib/coursera.redirect"),h=require("js/lib/ReactRouterAdapter"),b=require("js/lib/jade._h"),i=require("pages/open-course/common/constants"),x=require("pages/open-course/item/views/header.html"),f=l.extend({name:"itemHeader",multitracker:{namespace:"open_course.item_page",baseValues:["open_course_slug","item_id","item_name"],definitions:{open_course_slug:i.courseSlug,item_id:function item_id(){return this.itemMetadata.getId()},item_name:function item_name(){return this.itemMetadata.getName()}},events:{"outline_link.click":'click [data-js~="outline-link"]'},eventingVersion:2},events:{'click [data-js~="dashboard-link"]':"onDashboardLinkClick",'click [data-js~="login-link"]':"onLogInClick",'click [data-js~="signup-link"]':"onSignUpClick"},params:{required:["itemMetadata"],optional:["verificationDisplay","enrollmentMode","showLogo"]},initialize:function initialize(e){this.bind("view:merged",this.onMerge,this)},onMerge:function onMerge(e){this.itemMetadata=e.itemMetadata,this.renderBanners()},renderBanners:function renderBanners(){var e=this,i=this.model.get("id"),a=this.model.get("slug");s(i,a).then(function(i){if(i){var s=n.getActionContext().getStore("SessionStore");if(t.get("authenticated")&&s.isPreviewMode())return n.getActionContext().executeAction(u).then(function(){e.renderReactInto(o,"SessionEnrollBanner",{courseName:e.model.get("name"),courseId:e.model.get("id"),itemMetadata:e.itemMetadata},n.getComponentContext())})}else"EXPLICIT"===e.enrollmentMode&&e.renderReactInto(k,"JoinCourseBanner",{},{course:e.model,track:e.track.bind(e)})})},renderMetatag:function renderMetatag(){m.setMetatags({pageName:"title-and-description",context:{title:this.itemMetadata?this.itemMetadata.get("lesson.module.name"):"Coursera"}})},render:function render(){return this.$el.html(x({_h:b,config:p,constants:i,course:this.model,userIdentity:t,userAuthorization:e,showLogo:this.showLogo||!1})),this.renderReactInto(r,"PageHeader",a.ondemand,{router:h.rr}),this.renderMetatag(),this.renderBanners(),this},onDashboardLinkClick:function onDashboardLinkClick(){this.track("dashboard_link.click"),t.get("authenticated")?g.setLocation("/"):e.ensureAuthenticated()},onLogInClick:function onLogInClick(){this.track("sign_in_link.click"),e.ensureAuthenticated({mode:"login"})},onSignUpClick:function onSignUpClick(){this.track("sign_up_link.click"),e.ensureAuthenticated({mode:"signup"})}});module.exports=f.extend(d)});