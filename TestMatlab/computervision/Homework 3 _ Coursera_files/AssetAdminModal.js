define("bundles/asset-admin/components/AssetAdminModal",["require","exports","module","react-with-addons","vendor/cnpm/fluxible.v0-4/addons/connectToStores","vendor/cnpm/fluxible.v0-4/addons/FluxibleComponent","classnames","underscore","i18n!nls/asset-admin","bundles/phoenix/components/Modal","bundles/teach-course/components/BounceLoader","bundles/asset-admin/app","bundles/asset-admin/actions/AssetAdminActions","./AssetBrowser","./AssetUploader","./AssetsFooter","./NoticeMessage","bundles/asset-admin/constants/UploadStatus","css!./__styles__/AssetAdminModal"],function(require,exports,module){"use strict";function _defaults(e,a){for(var n=Object.getOwnPropertyNames(a),t=0;t<n.length;t++){var s=n[t],o=Object.getOwnPropertyDescriptor(a,s);o&&o.configurable&&void 0===e[s]&&Object.defineProperty(e,s,o)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var o=function(){function defineProperties(o,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(o,e.key,e)}}return function(e,t,s){return t&&defineProperties(e.prototype,t),s&&defineProperties(e,s),e}}(),a=function get(n,i,d){var s=!0;e:for(;s;){var t=n,r=i,l=d;s=!1,null===t&&(t=Function.prototype);var e=Object.getOwnPropertyDescriptor(t,r);if(void 0===e){var o=Object.getPrototypeOf(t);if(null===o)return void 0;n=o,i=r,d=l,s=!0,e=o=void 0;continue e}if("value"in e)return e.value;var a=e.get;if(void 0===a)return void 0;return a.call(l)}},e=require("react-with-addons"),h=require("vendor/cnpm/fluxible.v0-4/addons/connectToStores"),p=require("vendor/cnpm/fluxible.v0-4/addons/FluxibleComponent"),n=require("classnames"),_=require("underscore"),r=require("i18n!nls/asset-admin"),i=require("bundles/phoenix/components/Modal"),d=require("bundles/teach-course/components/BounceLoader"),c=require("bundles/asset-admin/app"),s=require("bundles/asset-admin/actions/AssetAdminActions"),u=s.initializeModal,m=s.getAssetsListByCourse,b=s.resetAssets,f=require("./AssetBrowser"),y=require("./AssetUploader"),A=require("./AssetsFooter"),v=require("./NoticeMessage"),l=require("bundles/asset-admin/constants/UploadStatus");require("css!./__styles__/AssetAdminModal");var t={Assets:"assets",Upload:"upload"},T=function(s){function AssetAdminModal(s,o){var e=this;_classCallCheck(this,AssetAdminModal),a(Object.getPrototypeOf(AssetAdminModal.prototype),"constructor",this).call(this,s,o),this.handleClose=function(){e.props.uploadStatus.state!==l.IN_PROGRESS&&e.props.onCancel()},this.selectTab=function(s){if(s!==e.state.activeTabId&&e.props.uploadStatus.state!==l.IN_PROGRESS&&(e.setState({activeTabId:s}),e.context.executeAction(b),s===t.Assets)){var o=e.props,a=o.courseId,n=o.assetType;e.context.executeAction(m,{courseId:a,assetType:n})}},this.state={activeTabId:s.tab}}return _inherits(AssetAdminModal,s),o(AssetAdminModal,null,[{key:"propTypes",value:{courseId:e.PropTypes.string.isRequired,course:e.PropTypes.object,assets:e.PropTypes.array,assetType:e.PropTypes.oneOf(["image","video","subtitle","pdf","audio","generic"]),pdfTemplate:e.PropTypes.oneOf(["slides"]),tab:e.PropTypes.oneOf([t.Assets,t.Upload]),nextPageIndex:e.PropTypes.string,hideHeaderTabs:e.PropTypes.bool,hideFooter:e.PropTypes.bool,hideSelectButton:e.PropTypes.bool,allowMultiple:e.PropTypes.bool,selectedAssets:e.PropTypes.array,uploadedAssets:e.PropTypes.array,uploadAttempts:e.PropTypes.object,uploadStatus:e.PropTypes.object,onSelect:e.PropTypes.func,onCancel:e.PropTypes.func.isRequired,isNoticeMessageDismissed:e.PropTypes.bool},enumerable:!0},{key:"contextTypes",value:{executeAction:e.PropTypes.func.isRequired},enumerable:!0},{key:"defaultProps",value:{tab:t.Assets,allowMultiple:!0},enumerable:!0}]),o(AssetAdminModal,[{key:"componentWillMount",value:function componentWillMount(){var e=this.props,s=e.courseId,o=e.assetType,a=e.tab,n=e.hideHeaderTabs,r=a===t.Upload&&n;this.context.executeAction(u,{courseId:s,assetType:o,hideAssets:r})}},{key:"componentDidUpdate",value:function componentDidUpdate(){var e=this.props,t=e.onSelect,s=e.uploadedAssets,o=e.allowMultiple;t&&AssetAdminModal.shouldReturnUploadedAssets(s,o)&&t(s)}},{key:"renderActiveTabId",value:function renderActiveTabId(){var s=this.props,o=s.course,u=s.assets,r=s.assetType,l=s.pdfTemplate,a=s.allowMultiple,c=s.isNoticeMessageDismissed,p=s.uploadedAssets,n=s.selectedAssets,m=s.uploadAttempts,b=s.uploadStatus,i=s.nextPageIndex;if(!o)return e.createElement("div",{className:"initial-loading"},e.createElement(d,null));return this.state.activeTabId===t.Upload?e.createElement(y,{course:o,assetType:r,pdfTemplate:l,allowMultiple:a,uploadedAssets:p,selectedAssets:n,uploadAttempts:m,uploadStatus:b}):e.createElement("div",null,e.createElement("h2",{className:"folder-name"},o.name),e.createElement(f,{assets:u,allowMultiple:a,selectedAssets:n,courseId:o.id,nextPageIndex:i}),e.createElement(v,{dismissed:c}))}},{key:"render",value:function render(){var s=this.props,a=s.hideFooter,l=s.selectedAssets,d=s.uploadedAssets,o=s.hideHeaderTabs,p=s.hideSelectButton,u=s.onSelect,m=s.onCancel,b=n({active:this.state.activeTabId===t.Assets}),c=n({active:this.state.activeTabId===t.Upload});return e.createElement("div",{className:"rc-AssetAdminModal"},e.createElement(i,{modalName:"AssetAdminModal",handleClose:this.handleClose},!o&&e.createElement("header",{className:"asset-modal-header"},e.createElement("a",{className:b,onClick:_(this.selectTab).partial(t.Assets)},r("Assets")),e.createElement("a",{className:c,onClick:_(this.selectTab).partial(t.Upload)},r("Upload"))),e.createElement("div",{className:"asset-modal-content"},this.renderActiveTabId()),!a&&e.createElement(A,{selectedAssets:l,uploadedAssets:d,onSelect:u,onCancel:m,hideSelectButton:p})))}}],[{key:"shouldReturnUploadedAssets",value:function value(e,t){return t&&e.length>0||!t&&1===e.length},enumerable:!0}]),AssetAdminModal}(e.Component),g=h(T,["AssetAdminStore"],function(t,s){var e=t.AssetAdminStore;return{course:e.getCourse(),assets:e.getAssets(),nextPageIndex:e.getNextPageIndex(),selectedAssets:e.getSelectedAssets(),uploadStatus:e.getUploadStatus(),uploadedAssets:e.getUploadedAssets(),uploadAttempts:e.getUploadAttempts(),isNoticeMessageDismissed:e.isNoticeMessageDismissed()}}),P=function(t){function FluxibleAssetAdminModal(){_classCallCheck(this,FluxibleAssetAdminModal),a(Object.getPrototypeOf(FluxibleAssetAdminModal.prototype),"constructor",this).apply(this,arguments)}return _inherits(FluxibleAssetAdminModal,t),o(FluxibleAssetAdminModal,[{key:"componentWillMount",value:function componentWillMount(){this.fluxibleContext=c.createContext()}},{key:"render",value:function render(){return e.createElement(p,{context:this.fluxibleContext.getComponentContext()},e.createElement(g,this.props))}}]),FluxibleAssetAdminModal}(e.Component);module.exports=P});