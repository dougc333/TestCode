define("bundles/programming/models/submissionSummary",["require","exports","module","backbone-associations","underscore","pages/open-course/assessment/models/exam/evaluation","bundles/programming/models/submissionPartEvaluation","bundles/programming/promises/submissionEvaluations"],function(require,exports,module){"use strict";var Backbone=require("backbone-associations"),_=require("underscore"),e=require("pages/open-course/assessment/models/exam/evaluation"),s=require("bundles/programming/models/submissionPartEvaluation"),a=require("bundles/programming/promises/submissionEvaluations"),i=Backbone.AssociatedModel.extend({defaults:{courseId:null,itemId:null,id:null,submittedAt:null,partEvaluations:null,evaluation:null},relations:[{type:Backbone.Associations.Many,key:"partEvaluations",relatedModel:s},{type:Backbone.Associations.One,key:"evaluation",relatedModel:e}],initialize:function initialize(){_(this).bindAll("onLoadFeedbacksSuccess","onLoadFeedbacksError")},parse:function parse(e){return e.partEvaluations=_(e.partEvaluations).chain().pairs().map(function(e){return _({}).extend(e[1],{partId:e[0]})}).value(),e},loadFeedbacks:function loadFeedbacks(e){if(!this.loadFeedbacksPromise){this.set("isLoadingFeedbacks",!0);var s={itemMetadata:e,submissionId:this.get("id")};this.loadFeedbacksPromise=a(s).then(this.onLoadFeedbacksSuccess,this.onLoadFeedbacksError)}return this.loadFeedbacksPromise},onLoadFeedbacksSuccess:function onLoadFeedbacksSuccess(e){var s=this;return this.set("isLoadingFeedbacks",!1),this.set("areFeedbacksLoaded",!0),_(e.definition.parts).each(function(e,i){var a=s.getPartEvaluation(i);a.set(e),e.definition&&a.set(e.definition)}),e},onLoadFeedbacksError:function onLoadFeedbacksError(e){this.set("isLoadingFeedbacks",!1),this.loadFeedbacksPromise=null},getPartEvaluation:function getPartEvaluation(e){return this.get("partEvaluations").findWhere({partId:e})}});module.exports=i});