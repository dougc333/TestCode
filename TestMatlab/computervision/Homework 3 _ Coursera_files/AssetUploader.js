define("bundles/asset-admin/components/AssetUploader",["require","exports","module","react-with-addons","react-dom","underscore","classnames","i18n!nls/asset-admin","js/lib/coursera.react-intl","bundles/asset-admin/actions/AssetAdminActions","bundles/asset-admin/constants/UploadStatus","./AssetsList","css!./__styles__/AssetUploader"],function(require,exports,module){"use strict";function _defaults(e,a){for(var o=Object.getOwnPropertyNames(a),t=0;t<o.length;t++){var s=o[t],r=Object.getOwnPropertyDescriptor(a,s);r&&r.configurable&&void 0===e[s]&&Object.defineProperty(e,s,r)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var l=function(){function defineProperties(r,s){for(var t=0;t<s.length;t++){var e=s[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}return function(e,t,s){return t&&defineProperties(e.prototype,t),s&&defineProperties(e,s),e}}(),o=function get(o,l,p){var s=!0;e:for(;s;){var t=o,n=l,i=p;s=!1,null===t&&(t=Function.prototype);var e=Object.getOwnPropertyDescriptor(t,n);if(void 0===e){var r=Object.getPrototypeOf(t);if(null===r)return void 0;o=r,l=n,p=i,s=!0,e=r=void 0;continue e}if("value"in e)return e.value;var a=e.get;if(void 0===a)return void 0;return a.call(i)}},e=require("react-with-addons"),c=require("react-dom"),_=require("underscore"),m=require("classnames"),s=require("i18n!nls/asset-admin"),y=require("js/lib/coursera.react-intl"),n=y.FormattedMessage,i=require("bundles/asset-admin/actions/AssetAdminActions"),p=i.initializeUploader,u=i.openFileBrowser,t=require("bundles/asset-admin/constants/UploadStatus"),d=require("./AssetsList"),r={};r[t.IN_PROGRESS]=s("Uploading"),r[t.FAILED]=s("Failed"),r[t.SUCCESS]=s("Uploaded"),require("css!./__styles__/AssetUploader");var f=function(r){function AssetUploader(){var e=this;_classCallCheck(this,AssetUploader),o(Object.getPrototypeOf(AssetUploader.prototype),"constructor",this).apply(this,arguments),this.state={isDropZoneActive:!1},this.handleDragEnter=function(t){t.preventDefault(),e.setState({isDropZoneActive:!0})},this.resetDropZone=function(){e.setState({isDropZoneActive:!1})},this.openFileBrowser=function(){e.context.executeAction(u)}}return _inherits(AssetUploader,r),l(AssetUploader,[{key:"componentDidMount",value:function componentDidMount(){var e=this.props.course.id,t=this.props.assetType,s=this.props.pdfTemplate,r=c.findDOMNode(this.refs.bulkUploadContainer);this.context.executeAction(p,{courseId:e,assetType:t,pdfTemplate:s,container:r})}},{key:"renderUploadFailure",value:function renderUploadFailure(){if(this.props.uploadStatus.state===t.FAILED)return e.createElement("div",{className:"upload-status-wrapper"},e.createElement(a,{files:this.props.uploadAttempts.success,status:t.SUCCESS}),e.createElement(a,{files:this.props.uploadAttempts.error,status:t.FAILED}))}},{key:"renderUploadedAssets",value:function renderUploadedAssets(){var t=this.props,s=t.uploadedAssets,r=t.selectedAssets,a=t.allowMultiple;if(!_(s).isEmpty())return e.createElement(d,{assets:s,selectedAssets:r,allowMultiple:a})}},{key:"renderUploader",value:function renderUploader(){var r=m("uploader-drop-zone-wrapper",{active:this.state.isDropZoneActive,hidden:this.props.uploadStatus.state!==t.IDLE});return e.createElement("div",{className:r,ref:"fileDropZone",onDragEnter:this.handleDragEnter,onDragLeave:this.resetDropZone,onDrop:this.resetDropZone},e.createElement("div",{className:"uploader-drop-zone"},e.createElement("div",{ref:"bulkUploadContainer"}),e.createElement("button",{className:"uploader-action",onClick:this.openFileBrowser},s("Add Files")),e.createElement("p",{className:"upload-guideline"},s("or drop files here")),e.createElement("p",{className:"upload-note"},e.createElement(n,{message:s("The files you upload will be added to {courseName} course assets."),courseName:this.props.course.name}))))}},{key:"renderUploadProgress",value:function renderUploadProgress(){var s=this.props.uploadStatus;if(s.state===t.IN_PROGRESS){var r=s.progress,o={width:r+"%"};return e.createElement("div",{className:"upload-status-wrapper"},e.createElement("div",{className:"upload-status-bar"},e.createElement("span",{className:"progress-bar",style:o})),e.createElement(a,{files:s.files,status:s.state}))}}},{key:"render",value:function render(){return e.createElement("div",{className:"rc-AssetUploader"},e.createElement("h2",{className:"folder-name"},e.createElement(n,{message:s("Upload to {courseName}"),courseName:this.props.course.name})),e.createElement("div",{className:"uploader-wrapper"},this.renderUploadProgress(),this.renderUploadFailure(),this.renderUploadedAssets(),this.renderUploader()))}}],[{key:"propTypes",value:{course:e.PropTypes.object.isRequired,assetType:e.PropTypes.string,pdfTemplate:e.PropTypes.string,allowMultiple:e.PropTypes.bool,uploadStatus:e.PropTypes.object.isRequired,uploadAttempts:e.PropTypes.object,selectedAssets:e.PropTypes.array,uploadedAssets:e.PropTypes.array},enumerable:!0},{key:"contextTypes",value:{executeAction:e.PropTypes.func.isRequired},enumerable:!0}]),AssetUploader}(e.Component),a=function(t){function UploadList(){_classCallCheck(this,UploadList),o(Object.getPrototypeOf(UploadList.prototype),"constructor",this).apply(this,arguments)}return _inherits(UploadList,t),l(UploadList,[{key:"render",value:function render(){var t=r[this.props.status]||"";return e.createElement("ul",{className:"asset-files-list"},_(this.props.files).map(function(s){return e.createElement("li",{key:s.name},e.createElement("span",{className:"asset-file-name"},s.name),e.createElement("span",{className:"asset-file-status"},t))}))}}],[{key:"propTypes",value:{files:e.PropTypes.array,status:e.PropTypes.string},enumerable:!0}]),UploadList}(e.Component);module.exports=f});