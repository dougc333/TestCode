define("bundles/ondemand/components/menu/Menu",["require","exports","module","classnames","react-router","react-with-addons","js/app/retracked","bundles/ondemand/actions/ViewActionCreators","bundles/ondemand/components/CourseHeader","bundles/ondemand/components/menu/FullMenuItems","bundles/ondemand/components/menu/PreviewMenuItems","bundles/ondemand/constants/Constants","bundles/ondemand/stores/MenuStore","bundles/ondemand/utils/isPreviewMode","bundles/ondemand/utils/lastSeenWeek","bundles/ondemand/stores/SessionStore","bundles/ondemand/utils/url","bundles/phoenix/utils/matchMedia","pages/open-course/common/models/course","pages/open-course/common/constants","bundles/discussions/utils/discussionsUrl","bundles/phoenix/lib/waitForStores","css!./__styles__/Menu"],function(require,exports,module){"use strict";var n=require("classnames"),h=require("react-router"),U=h.State,e=require("react-with-addons"),c=require("js/app/retracked"),M=require("bundles/ondemand/actions/ViewActionCreators"),r=require("bundles/ondemand/components/CourseHeader"),u=require("bundles/ondemand/components/menu/FullMenuItems"),d=require("bundles/ondemand/components/menu/PreviewMenuItems"),a=require("bundles/ondemand/constants/Constants"),s=a.mainNavItems,o=require("bundles/ondemand/stores/MenuStore"),m=require("bundles/ondemand/utils/isPreviewMode"),p=require("bundles/ondemand/utils/lastSeenWeek"),k=p.getLastSeenWeek,b=require("bundles/ondemand/stores/SessionStore"),S=require("bundles/ondemand/utils/url"),i=S.getWeekUrl,g=require("bundles/phoenix/utils/matchMedia"),C=g.isAboveHeight,v=require("pages/open-course/common/models/course"),f=require("pages/open-course/common/constants"),E=f.courseSlug,P=require("bundles/discussions/utils/discussionsUrl"),y=P.getCourseDiscussionsUrl,I=require("bundles/phoenix/lib/waitForStores"),w=650;require("css!./__styles__/Menu");var t=e.createClass({displayName:"Menu",contextTypes:{router:e.PropTypes.object.isRequired},propTypes:{onUpdate:e.PropTypes.func.isRequired,course:e.PropTypes.instanceOf(v).isRequired,currentWeek:e.PropTypes.number.isRequired,isCourseComplete:e.PropTypes.bool.isRequired,passedWithVerification:e.PropTypes.bool.isRequired,isPreviewMode:e.PropTypes.bool.isRequired},statics:{getStateFromStores:function getStateFromStores(){return{showingMobileMenu:o.showingMobileMenu()}}},getInitialState:function getInitialState(){return t.getStateFromStores()},componentWillMount:function componentWillMount(){this.setSelectedNavItem()},componentDidMount:function componentDidMount(){o.addChangeListener(this.handleChange),this.props.onUpdate(),document.body.style.overflow="hidden"},componentWillReceiveProps:function componentWillReceiveProps(e){this.handleChange(e),this.setSelectedNavItem()},componentDidUpdate:function componentDidUpdate(){this.props.onUpdate()},componentWillUnmount:function componentWillUnmount(){o.removeChangeListener(this.handleChange),document.body.style.overflow="visible"},handleChange:function handleChange(){this.setState(t.getStateFromStores())},getScheduleUrl:function getScheduleUrl(){var e=k();if(e)return i(e);var s=this.props.currentWeek||1;return i(s)},setSelectedNavItem:function setSelectedNavItem(){var n=this.context.router.routes,t=n.length-1,e=n[t].name;"welcome"===e?e=s.HOME:"assignments"===e?e=s.ASSIGNMENTS:"week"===e||"ty"===e||"module"===e?e=s.COURSE:this.context.router.isActive({pathname:y()})?e=s.DISCUSSIONS:"info"===e||"CDP"===e?e=s.INFO:e&&e.indexOf("resources")>=0&&(e=s.REFERENCES),this.setState({selectedItem:e})},hideMobileMenu:function hideMobileMenu(){this.state.showingMobileMenu&&M.toggleMobileMenu()},render:function render(){var s=this.props.course,o=n("rc-Menu","align-self-stretch","theme-dark",{"showing-mobile-menu":this.state.showingMobileMenu}),i=n("menu","od-dark","od-menu-bar","theme-dark",{"vertical-box":C(w)}),a=n("mobile-menu-overlay","bt3-visible-xs",{"hide-mobile-menu":!this.state.showingMobileMenu}),t={hideMobileMenu:this.hideMobileMenu,selectedItem:this.state.selectedItem,scheduleUrl:this.getScheduleUrl(),courseId:s.get("id")};return e.createElement("div",{className:o},e.createElement("div",{className:i,ref:"menu"},!!s&&s.has("name")&&s.has("universities")&&e.createElement(r,{thumbnail:s.getFirstPartnerSquareLogo(),universities:s.get("universities")}),this.props.isPreviewMode?e.createElement(d,t):e.createElement(u,t)),e.createElement("div",{className:a,onClick:this.hideMobileMenu}))}}),l=c.createTrackedContainer(function(){return{namespace:{page:"menu"}}})(t);module.exports=I(l,["CourseScheduleStore","CourseStore","CourseViewGradeStore","CourseMembershipStore"],function(e,i){var s=e.CourseScheduleStore,n=e.CourseStore,t=e.CourseViewGradeStore,o=e.CourseMembershipStore;return{course:n.getMetadata(),currentWeek:s.getCurrentWeek(),isCourseComplete:s.isCourseComplete(),passedWithVerification:t.hasPassedCourseWithVerification(),isPreviewMode:m(b.isPreviewMode(),o.isEnrolled())}})});